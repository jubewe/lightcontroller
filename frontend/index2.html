<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Lightcontroller</title></head><body><h3>Lightcontroller</h3><div id="lightcontrols"></div><div id="lightcontrolsgroup"></div><div id="lightcontrolsall"></div></body></html><script>const url = new URL(document.baseURI);/* DMX Address Name;dmxAddressFixture (start) *//* const lights = "SomeName0;0;group1\nSomeName1;1;group1\nSomeName2;10;group3\nSomeName4;20;group2\nSomeName5;30"; */const lights = "{{CONFIG}}";console.debug("Loaded config", lights);let groups = {};lights.split("\n").forEach(line => {let splits = line.split(";");if (!groups[splits[2]]) groups[splits[2]] = [];groups[splits[2]].push(line);});const ws = new WebSocket(`ws://${window.location.hostname}/ws`);ws.onopen = () => {console.log("WS Opened");};ws.onmessage = (m) => {console.log("WS Message", m);};ws.onerror = (e) => {console.error("WS Error", e);};class functions {static request = (u, options) => {return new Promise((resolve, reject) => {if (!/^http(s)*:\/{2}/i.test(u)) u = url.origin + u;options = (options ?? {});fetch(u, options).then(v => {resolve(v.body);}).catch(reject);});};static submitConfig = (config) => {this.request("/config", {headers: {"plain": (typeof config !== "string" ? JSON.stringify(config) : config)},method: "POST"}).then(() => {console.debug("POST Config Success");}).catch(e => {console.error("POST Config error", e);});};static getWhite = (hex) => {if (hex.replace(/^#/, "") === "FFFFFF") return 255;return 0;};static hexToRGBParsed = (hex) => {let w = functions.getWhite(hex);let rgb = functions.hexToRGB(hex);let r = {...(w === 255 ? { r: 0, g: 0, b: 0 } : rgb),w: w};return r;};static hexToRGB = (hex) => {let r = {};let hexParts = hex.replace(/^#/, "").match(/\w{2}/g);hexParts.forEach((a, i) => r[["r", "g", "b"][i]] = parseInt(a, 16));return r;};static updateLight = (addr, dimm, r, g, b, w, str) => {let args = [addr, dimm, r, g, b, w, str];let data = [].concat(args, Array(7).slice(0, (7 - args.length)));ws.send(data.join(";"));};};class scripts {static loadLights = () => {lights.split("\n").forEach((line, i) => {let [lightName, lightDmxAddress, lightGroupName] = line.split(";");let controlsContainer = document.createElement("div");controlsContainer.id = `controls${lightDmxAddress}`;controlsContainer.classList.add("controlsContainer");let controlsTitle = document.createElement("h");controlsTitle.classList.add("controlsTitle");controlsTitle.innerText = lightName;let controlsGroupTitle = document.createElement("h");controlsGroupTitle.classList.add("controlsGroupTitle");controlsGroupTitle.innerText = lightGroupName;let controlsColorInput = elements.controlsColorInput(controlsContainer.id);let controlsDimmerInput = elements.controlsDimmerInput(controlsContainer.id);let controlsSubmit = document.createElement("button");controlsSubmit.innerText = "Update";controlsSubmit.classList.add("controlsSubmit");controlsSubmit.onclick = () => {let pickedColorHex = controlsColorInput.value;let pickedColor = functions.hexToRGBParsed(pickedColorHex);let pickedDimm = controlsDimmerInput.value;functions.updateLight(lightDmxAddress, pickedDimm, pickedColor.r, pickedColor.g, pickedColor.b, pickedColor.w, 0);};[controlsTitle, controlsGroupTitle, controlsColorInput, controlsDimmerInput, controlsSubmit].forEach(a => controlsContainer.appendChild(a));document.querySelector("#lightcontrols").appendChild(controlsContainer);});};static loadLightGroups = () => {let groupControlsContainer = document.createElement("div");groupControlsContainer.classList.add("groupControlsContainer");groupControlsContainer.id = "controlsGroup";let groupControlsTitle = document.createElement("h");groupControlsTitle.innerText = "Group Controls";groupControlsTitle.classList.add("controlsTitle");let groupSelector = document.createElement("select");Object.keys(groups).forEach(group => {let groupOption = document.createElement("option");groupOption.innerText = group;groupOption.value = group;groupSelector.appendChild(groupOption);});let groupControlsColorInput = elements.controlsColorInput("controlsGroup");let groupControlsDimmerInput = elements.controlsDimmerInput("controlsGroup");let groupControlsSubmit = document.createElement("button");groupControlsSubmit.innerText = "Update";groupControlsSubmit.onclick = () => { append(true) };groupControlsSubmit.classList.add("controlsSubmit");groupControlsColorInput.onchange = () => { append() };groupControlsDimmerInput.onchange = () => { append() };function append(update) {let pickedColorHex = groupControlsColorInput.value;let pickedColor = functions.hexToRGBParsed(pickedColorHex);let pickedDimm = groupControlsDimmerInput.value;let pickedGroup = groupSelector.value;/* console.log("Append group", pickedColorHex, pickedColor, pickedDimm, pickedGroup); */if (update) functions.updateLight(groups[pickedGroup].map(a => a.split(";")[1]).join(","), pickedDimm, pickedColor.r, pickedColor.g, pickedColor.b, pickedColor.w, 0);groups[pickedGroup].map(a => a.split(";")[1]).forEach(light => {let lightAddress = lights.split("\n").map(a => a.split(";")[1]).filter(a => a == light)[0];if (lightAddress === undefined) return;if (!document.getElementById(`controls${lightAddress}`)) return;document.getElementById(`controls${lightAddress}-color`).value = pickedColorHex;document.getElementById(`controls${lightAddress}-dimm`).value = pickedDimm;});};[groupControlsTitle, groupSelector, groupControlsColorInput, groupControlsDimmerInput, groupControlsSubmit].forEach(a => groupControlsContainer.appendChild(a));document.querySelector("#lightcontrolsgroup").appendChild(groupControlsContainer);};static loadLightAll = () => {let allControlsContainer = document.createElement("div");allControlsContainer.classList.add("groupControlsContainer");allControlsContainer.id = "controlsGroupAll";let allControlsTitle = document.createElement("h");allControlsTitle.innerText = "Master Controls";allControlsTitle.classList.add("controlsTitle");let allControlsColorInput = elements.controlsColorInput("controlsGroupAll");let allControlsDimmerInput = elements.controlsDimmerInput("controlsGroupAll");let allControlsSubmit = document.createElement("button");allControlsSubmit.innerText = "Update";allControlsSubmit.classList.add("controlsSubmit");allControlsSubmit.onclick = () => { append(true) };allControlsColorInput.onchange = () => { append() };allControlsDimmerInput.onchange = () => { append() };function append(update) {let pickedColorHex = allControlsColorInput.value;let pickedColor = functions.hexToRGBParsed(pickedColorHex);let pickedDimm = allControlsDimmerInput.value;/* console.log("Append all", pickedColorHex, pickedColor, pickedDimm); */if (update) functions.updateLight(lights.split("\n").map(a => a.split(";")[1]).join(","), pickedDimm, pickedColor.r, pickedColor.g, pickedColor.b, pickedColor.w, 0);lights.split("\n").map((light, i) => {if (!document.getElementById(`controls${i}`)) return;document.getElementById(`controls${i}-color`).value = pickedColorHex;document.getElementById(`controls${i}-dimm`).value = pickedDimm;});if (!document.getElementById(`controlsGroup`)) return;document.getElementById(`controlsGroup-color`).value = pickedColorHex;document.getElementById(`controlsGroup-dimm`).value = pickedDimm;};[allControlsTitle, allControlsColorInput, allControlsDimmerInput, allControlsSubmit].forEach(a => allControlsContainer.appendChild(a));document.querySelector("#lightcontrolsgroup").appendChild(allControlsContainer);};};class elements {static br = () => { return document.createElement("br") };static spacer = () => { return document.createElement("spacer") };static controlsColorInput = (containerId) => {let controlsColorInput = document.createElement("input");if (containerId) controlsColorInput.id = `${containerId}-color`;controlsColorInput.classList.add("controlsColorInput");controlsColorInput.type = "color";controlsColorInput.defaultValue = "#FFFFFF";return controlsColorInput;};static controlsDimmerInput = (containerId) => {let controlsDimmerInput = document.createElement("input");if (containerId) controlsDimmerInput.id = `${containerId}-dimm`;controlsDimmerInput.classList.add("controlsDimmerInput");controlsDimmerInput.type = "range";controlsDimmerInput.value = "0";controlsDimmerInput.min = "0";controlsDimmerInput.max = "255";controlsDimmerInput.defaultValue = "0";return controlsDimmerInput;};};window.onload = () => { scripts.loadLights(); scripts.loadLightGroups(); scripts.loadLightAll() };</script><style>* {scrollbar-width: thin;font-family: "Trebuchet MS", "Lucida Sans Unicode", "Lucida Grande", "Lucida Sans", Arial, sans-serif;border-radius: 5px;word-break: normal;line-break: anywhere;text-align: center;user-select: none;padding: 3px;}body {background-color: #233d4d;transition: ease-in 2s;color: #f1faee;padding: 3px;}#lightcontrols {display: flex;place-items: center;flex-wrap: wrap;justify-content: center;}.controlsContainer {display: flex;flex: 1 0 24%;}.controlsContainer,.groupControlsContainer {max-width: 23%;padding: 6px;margin: 2px;width: 25%;gap: 3px;/* display: inline-block; */border: 1px solid;background-color: #1d2d44;display: flex;flex-direction: column;align-items: center;justify-content: space-evenly;}#lightcontrolsgroup {display: flex;justify-content: center;}.groupControlsContainer {max-width: none;width: 40%;}spacer {display: flex;height: 10px;}.controlsTitle {font-size: large;}.controlsDimmerInput {display: inline-block;width: 80%;/* transform: rotate(90deg); */}.controlsColorInput,.controlsSubmit {border: none;}.controlsGroupTitle {font-size: small;}#lightcontrolsgroup div {vertical-align: top;}</style>