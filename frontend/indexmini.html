<!-- Welcome to the Frontend --><!-- https://github.com/jubewe/lightcontroller --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible"content="IE=edge"><meta name="viewport"content="width=device-width,initial-scale=1"><title>Lightcontroller</title></head><body><h3>Lightcontroller</h3><div id="lightcontrols"></div><div id="lightcontrolsgroup"></div></body></html><script>const url=new URL(document.baseURI),lights="Bühne Links Außen Hinten;1;1;Bühne,Links,Bühne Links,Bühne Hinten,Bühne Außen,Bühne Links Außen,Bühne Links Hinten---Bühne Links Innen Hinten;7;1;Bühne,Links,Bühne Links,Bühne Hinten,Bühne Innen,Bühne Links Innen,Bühne Links Hinten---Bühne Rechts Innen Hinten;13;1;Bühne,Rechts,Bühne Rechts,Bühne Hinten,Bühne Innen,Bühne Rechts Innen,Bühne Rechts Hinten---Bühne Rechts Außen Hinten;19;1;Bühne,Rechts,Bühne Rechts,Bühne Hinten,Bühne Außen,Bühne Rechts Außen,Bühne Rechts Hinten---Bühne Links Außen Vorne;25;1;Bühne,Links,Bühne Links,Bühne Vorne,Bühne Außen,Bühne Links Außen,Bühne Links Vorne---Bühne Links Innen Vorne;31;1;Bühne,Links,Bühne Links,Bühne Vorne,Bühne Innen,Bühne Links Innen,Bühne Links Vorne---Bühne Rechts Innen Vorne;37;1;Bühne,Rechts,Bühne Rechts,Bühne Vorne,Bühne Innen,Bühne Rechts Innen,Bühne Rechts Vorne---Bühne Rechts Außen Vorne;43;1;Bühne,Rechts,Bühne Rechts,Bühne Vorne,Bühne Außen,Bühne Rechts Außen,Bühne Rechts Vorne---Spot Links Oben;49;6;Spots,Spots Links,Spots Oben,Links---Spot Links Unten;55;6;Spots,Spots Links,Spots Unten,Links---Spot Rechts Oben;61;6;Spots,Spots Rechts,Spots Oben,Rechts---Spot Rechts Unten;67;6;Spots,Spots Rechts,Spots Unten,Rechts";console.debug("Loaded config",lights);const channels=[["Red","r","#ff0000",0],["Green","g","#00ff00",0],["Blue","b","#0000ff",0],["White","w","#ffffff",255],["Amber","a","#ffbf00",0],["UV","u","#5f4b8b",0]],rangeInputMin=0,rangeInputMax=255,rangeInputDefault=0,fadeRangeMin=0,fadeRangeMax=30,fadeRangeDefault=0,fadeDefaultTime=1,fadeLiveDefaultTime=0,channelsPerRGBLight=6;let groups={},liveUpdate=!1,groupToggle=!0;lights.split("---").forEach((e=>{let n=e.split(";")[3];0!==n.length&&n.split(",").forEach((n=>{groups[encodeURI(n)]||(groups[encodeURI(n)]=[]),groups[encodeURI(n)].push(e)}))}));const ws=new WebSocket(`ws://${window.location.hostname}/ws`);ws.onopen=()=>{console.log("WS Opened")},ws.onmessage=e=>{console.log("WS Message",e)},ws.onerror=e=>{console.error("WS Error",e)};class functions{static request=(e,n)=>new Promise(((t,o)=>{/^http(s)*:\/{2}/i.test(e)||(e=url.origin+e),n=n??{},fetch(e,n).then((e=>{t(e.body)})).catch(o)}));static submitConfig=e=>{this.request("/config",{headers:{plain:"string"!=typeof e?JSON.stringify(e):e},method:"POST"}).then((()=>{console.debug("POST Config Success")})).catch((e=>{console.error("POST Config error",e)}))};static getWhite=e=>"ffffff"===e.replace(/^#/,"").toLowerCase()?255:0;static hexToRGBParsed=e=>functions.hexToRGB(e);static hexToRGB=e=>{let n={};return e.replace(/^#/,"").match(/\w{2}/g).forEach(((e,t)=>n[["r","g","b"][t]]=parseInt(e,16))),n};static RGBToHex=(e,n,t,o)=>{let l="#";return l+=functions.pad2(Math.abs(e).toString(16)),l+=functions.pad2(Math.abs(n).toString(16)),l+=functions.pad2(Math.abs(t).toString(16)),l};static pad2=e=>/^\d$/.test(e)?`${parseInt(e)<10?"0":""}${e}`:`${e.length<2?"0":""}${e}`;static getValuesFromChannels=e=>{let n={};return channels.forEach((t=>{n[t[1]]=document.getElementById(`${e}-channels-${t[1]}`).value})),n};static appendValuesFromChannels=e=>{let n=functions.getValuesFromChannels(e),[t,o,l]=[n.r,n.g,n.b],s=functions.RGBToHex(t,o,l);return document.getElementById(`${e}-color`).value=s,s};static appendHexToChannels=(e,n)=>{let t=n??document.getElementById(`${e}-color`).value,o=functions.hexToRGBParsed(t),l={};return Object.keys(o).forEach((n=>{document.getElementById(`${e}-channels-${n}`).value=o[n],l[n]=o[n]})),l};static appendToChannels=(e,n)=>{Object.keys(n).forEach((t=>{document.getElementById(`${e}-channels-${t}`).value=n[t]}))};static updateLight=(e,n,t,o,l,s,c,a,r)=>{let i=[e,...[e,t,o,l,s,c,a,1e3*(r??0)].slice(1,8).map((e=>Math.floor(parseInt(e)*(1-(n??0)/100))))],d=[].concat(i,Array(8).slice(0,8-i.length));ws.send(d.join(";"))};static updateLightnoRGB=(e,n,t)=>{ws.send([e,Math.floor(255*(1-n/100)),...[...Array(5)].map((e=>0)),1e3*t].join(";"))}}class scripts{static loadLights=()=>{lights.split("---").forEach(((e,n)=>{let[t,o,l,s]=e.split(";"),c=parseInt(l)>1,a=document.createElement("div");a.id=`controls${o}`,a.classList.add("controlsContainer");let r=document.createElement("h");r.classList.add("controlsTitle"),r.innerText=t;let i=document.createElement("h");i.classList.add("controlsGroupTitle"),i.innerText=s.split(",").join(", ");let d=elements.controlsColorInput(a.id),u=elements.controlsChannelInputs(a.id),h=elements.controlsDimmerInput(a.id),p=elements.controlsFadeInput(a.id);d.onchange=()=>{g(),functions.appendHexToChannels(a.id)},u.onchange=()=>{g(),functions.appendValuesFromChannels(a.id)},h.onchange=()=>{g()},p.onchange=()=>{g()};let m=document.createElement("button");function g(e){let n=h.querySelector(".controlsDimmerInput").value,t=p.querySelector(".controlsFadeInput").value;if(!c)return void((e||liveUpdate)&&functions.updateLightnoRGB(o,n,t));let l=d.querySelector(".controlsColorInput").value,s=(functions.hexToRGBParsed(l),functions.getValuesFromChannels(a.id));(e||liveUpdate)&&functions.updateLight(o,n,...Object.values(s),t)}m.innerText="Update",m.classList.add("controlsSubmit"),m.onclick=()=>{g(!0)},[r,i,...c?[d,u]:[],h,p,m].forEach((e=>a.appendChild(e))),document.querySelector("#lightcontrols").appendChild(a)}))};static loadLightGroups=()=>{let e=document.createElement("div");e.classList.add("groupControlsContainer"),e.id="controlsGroup";let n=document.createElement("h");n.innerText="Group Controls",n.classList.add("controlsTitle");let t=document.createElement("select");Object.keys(groups).forEach((e=>{let n=document.createElement("option");n.innerText=decodeURI(e),n.value=e,t.appendChild(n)}));let o=elements.controlsColorInput(e.id),l=elements.controlsChannelInputs(e.id),s=elements.controlsDimmerInput(e.id),c=elements.controlsFadeInput(e.id),a=document.createElement("button");function r(n,l,a){let r=o.querySelector(".controlsColorInput").value,i=s.querySelector(".controlsDimmerInput").value,d=c.querySelector(".controlsFadeInput").value,u=t.value;l&&functions.appendHexToChannels(e.id,r),a&&(r=functions.appendValuesFromChannels(e.id));let h=functions.getValuesFromChannels(e.id);(n||liveUpdate)&&functions.updateLight(groups[u].filter((e=>parseInt(e.split(";")[2])>1)).map((e=>e.split(";")[1])).join(","),i,...Object.values(h),d),groups[u].map((e=>e.split(";")[1])).forEach((e=>{let n=lights.split("---").filter((n=>n.split(";")[1]===e))[0]?.split(";"),t=n?.[1];if(void 0===t)return;if(!document.getElementById(`controls${t}`))return;let o=parseInt(n[2])>1;document.getElementById(`controls${t}-dimm`).value=i,document.getElementById(`controls${t}-fade`).value=d,o&&(document.getElementById(`controls${t}-color`).value=r,functions.appendToChannels(`controls${t}`,h))}))}a.innerText="Update",a.classList.add("controlsSubmit"),a.onclick=()=>{r(!0)},o.onchange=()=>{r(!1,!0,!1)},l.onchange=()=>{r(!1,!1,!0)},s.onchange=()=>{r()},c.onchange=()=>{r()},[n,t,o,l,s,c,a].forEach((n=>e.appendChild(n))),document.querySelector("#lightcontrolsgroup").appendChild(e)};static loadLightAll=()=>{let e=document.createElement("div");e.classList.add("groupControlsContainer"),e.id="controlsGroupAll";let n=document.createElement("h");n.innerText="Master Controls",n.classList.add("controlsTitle");let t=elements.controlsColorInput(e.id),o=elements.controlsChannelInputs(e.id),l=elements.controlsDimmerInput(e.id),s=elements.controlsFadeInput(e.id),c=document.createElement("button");function a(n,o,c){let a=t.querySelector(".controlsColorInput").value,r=l.querySelector(".controlsDimmerInput").value,i=s.querySelector(".controlsFadeInput").value;o&&functions.appendHexToChannels(e.id,a),c&&(a=functions.appendValuesFromChannels(e.id));let d=functions.getValuesFromChannels(e.id);(n||liveUpdate)&&functions.updateLight(lights.split("---").filter((e=>parseInt(e.split(";")[2])>1)).map((e=>e.split(";")[1])).join(","),r,...Object.values(d),i),lights.split("---").map((e=>e.split(";"))).map((e=>{let n=e[1];if(!document.getElementById(`controls${n}`))return;let t=parseInt(e[2])>1;document.getElementById(`controls${n}-dimm`).value=r,document.getElementById(`controls${n}-fade`).value=i,t&&(document.getElementById(`controls${n}-color`).value=a,functions.appendToChannels(`controls${n}`,d))})),document.getElementById("controlsGroup")&&(document.getElementById("controlsGroup-color").value=a,document.getElementById("controlsGroup-dimm").value=r,document.getElementById("controlsGroup-fade").value=i,functions.appendToChannels("controlsGroup",d))}c.innerText="Update",c.classList.add("controlsSubmit"),c.onclick=()=>{a(!0)},t.onchange=()=>{a(!1,!0,!1)},o.onchange=()=>{a(!1,!1,!0)},l.onchange=()=>{a()},s.onchange=()=>{a()},[n,t,o,l,s,c].forEach((n=>e.appendChild(n))),document.querySelector("#lightcontrolsgroup").appendChild(e)};static loadLiveUpdate=()=>{let e=document.createElement("div");e.id="liveUpdateContainer";let n=document.createElement("h");n.id="liveUpdateTitle",n.innerText="Live Update";let t=document.createElement("input");t.type="checkbox",t.onchange=()=>{liveUpdate=t.checked,scripts.appendLiveUpdate()},[n,t].forEach((n=>e.appendChild(n))),document.querySelector("body").appendChild(e)};static loadGroupToggle=()=>{let e=document.createElement("div");e.id="groupToggleContainer";let n=document.createElement("h");n.id="groupToggleTitle",n.innerText="Show groups";let t=document.createElement("input");t.type="checkbox",t.defaultChecked=!0,t.onchange=()=>{groupToggle=t.checked,scripts.appendGroupToggleUpdate()},[n,t].forEach((n=>e.appendChild(n))),document.querySelector("body").appendChild(e)};static appendLiveUpdate=()=>{document.querySelectorAll(".controlsSubmit").forEach((e=>{liveUpdate?e.classList.add("hidden"):e.classList.remove("hidden")})),document.querySelectorAll(".controlsFade").forEach((e=>{e.value=liveUpdate?0:1}))};static appendGroupToggleUpdate=()=>{document.querySelectorAll(".controlsGroupTitle").forEach((e=>{groupToggle?e.classList.remove("hidden"):e.classList.add("hidden")}))}}class elements{static br=()=>document.createElement("br");static spacer=()=>document.createElement("spacer");static controlsColorInput=e=>{let n=document.createElement("div");n.classList.add("controlsColorPickerContainer");let t=document.createElement("h");t.innerText="Color Picker";let o=document.createElement("input");return e&&(o.id=`${e}-color`),o.classList.add("controlsColorInput"),o.type="color",o.defaultValue="#000000",[t,o].forEach((e=>n.appendChild(e))),n};static controlsChannelInputs=e=>{let n=document.createElement("div");n.classList.add("controlsChannelsContainer");let t=document.createElement("div"),o=document.createElement("h");o.innerText="Channels";let l=document.createElement("div");e&&(l.id=`${e}-channels`),l.classList.add("controlsChannelsInputContainer");let s=document.createElement("div");return e&&(s.id=`${e}-channel-titles`),s.classList.add("controlsChannelTitlesContainer"),channels.forEach((n=>{let t=document.createElement("input");e&&(t.id=`${l.id}-${n[1]}`),t.classList.add("controlsChannelInput",`controlsChannel-${n[1]}`,"vertical"),t.type="range",t.style.backgroundColor=n[2],t.min=0,t.max=255,t.defaultValue=n[3];let o=document.createElement("h");o.classList.add("controlsChannelTitle"),o.title=n[0],o.innerText=n[1],l.appendChild(t),s.appendChild(o)})),[o,l,s].forEach((e=>t.appendChild(e))),n.appendChild(t),n};static controlsDimmerInput=e=>{let n=document.createElement("div");n.classList.add("controlsDimmerContainer");let t=document.createElement("div"),o=document.createElement("h");o.innerText="Dimmer";let l=document.createElement("input");return e&&(l.id=`${e}-dimm`),l.classList.add("dimmer"),l.classList.add("controlsDimmerInput","horizontal"),l.type="range",l.min=0,l.max=100,l.defaultValue=0,[o,l].forEach((e=>t.appendChild(e))),n.appendChild(t),n};static controlsFadeInput=e=>{let n=document.createElement("div");n.classList.add("controlsFadeContainer");let t=document.createElement("div"),o=document.createElement("h");o.innerText="Fade";let l=document.createElement("input");return l.id=`${e}-fade`,l.classList.add("controlsFadeInput","horizontal"),l.type="range",l.min=0,l.max=30,l.defaultValue=0,[o,l].forEach((e=>t.appendChild(e))),n.appendChild(t),n}}window.onload=()=>{scripts.loadLights(),scripts.loadLightGroups(),scripts.loadLightAll(),scripts.loadLiveUpdate(),scripts.loadGroupToggle()}</script><style>*{scrollbar-width:thin;font-family:"Trebuchet MS","Lucida Sans Unicode","Lucida Grande","Lucida Sans",Arial,sans-serif;border-radius:10px;text-align:center;user-select:none;padding:3px}.hidden{display:none}@media screen and (-webkit-min-device-pixel-ratio:0){.controlsChannelInput{overflow:hidden;appearance:none;-webkit-appearance:none;background-color:#fff;border:1px solid}.controlsChannelInput::-webkit-slider-runnable-track{height:10px;appearance:none;-webkit-appearance:none;color:#fff;background-color:transparent;margin-top:-1px}.controlsChannelInput::-webkit-slider-thumb{width:10px;-webkit-appearance:none;height:10px;border:1px solid #fff;border-radius:100%;background:0 0;box-shadow:396px 0 2px 400px #000}}.horizontal{cursor:w-resize}.vertical{cursor:n-resize}.controlsChannelInput{border:1px solid #fff;background-color:#000}.controlsChannelInput::-moz-range-progress{background-color:#fcca46}.controlsChannelInput::-moz-range-track{background-color:#000}body{background-color:#233d4d;transition:ease-in 2s;color:#f1faee;padding:3px}#lightcontrols,#lightcontrolsgroup{display:flex;place-items:center;flex-wrap:wrap;justify-content:center;align-items:stretch}.controlsContainer{display:flex;flex:1 0 24%}.controlsContainer,.groupControlsContainer{max-width:23%;padding:6px;margin:2px;width:25%;gap:3px;border:1px solid;background-color:#1d2d44;display:flex;flex-direction:column;align-items:center;justify-content:space-evenly}.groupControlsContainer{max-width:none;width:40%}spacer{display:flex;height:10px}.controlsTitle{font-size:large}.controlsDimmerInput,.controlsFadeInput{width:80%}.controlsColorInput,.controlsSubmit{border:none;outline:0}.controlsColorInput{background-color:transparent;box-sizing:content-box;padding:0}.controlsSubmit{padding:4px}.controlsGroupTitle{font-size:small}.controlsChannelsContainer,.controlsColorPickerContainer,.controlsDimmerContainer,.controlsFadeContainer{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;border:1px solid;flex-direction:column;width:100%}.controlsDimmerContainer>div,.controlsFadeContainer>div{display:flex;flex-direction:column;justify-content:center;align-items:center;width:90%}.controlsChannelsContainer{flex-direction:column;flex-wrap:nowrap}.controlsChannelsInputContainer{display:flex;flex-wrap:wrap;justify-content:center;flex-direction:column;transform:rotate(-90deg);row-gap:1px;justify-content:center;aspect-ratio:1/1.2}.controlsChannelTitle{cursor:help}.controlsChannelTitlesContainer{display:flex;justify-content:space-evenly}.controlsColorPickerContainer{flex-direction:column;justify-content:center}#liveUpdateContainer{background-color:#38a3a5;z-index:10;position:absolute;right:10px;top:10px}#groupToggleContainer{background-color:#38a3a5;z-index:10;position:absolute;left:10px;top:10px}</style>