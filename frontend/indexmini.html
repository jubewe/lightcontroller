<!-- Welcome to the Frontend --><!-- https://github.com/jubewe/lightcontroller --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible"content="IE=edge"><meta name="viewport"content="width=device-width,initial-scale=1"><title>Lightcontroller</title></head><body><h3>Lightcontroller</h3><div id="lightcontrols"></div><div id="lightcontrolsgroup"></div></body><footer><h>This Controller is made by</h><a href="https://github.com/jubewe">Julian (Frontend)</a> <a href="https://github.com/jojo-06">Johannes (PCB + Backend)</a> <a href="https://github.com/jubewe/lightcontroller">Documentation (GitHub)</a></footer></html><script>const url=new URL(document.baseURI),splitter="---",lights="Bühne Links Außen Hinten;1;1;Bühne,Links,Bühne Links,Bühne Hinten,Bühne Außen,Bühne Links Außen,Bühne Links Hinten---Bühne Links Innen Hinten;7;1;Bühne,Links,Bühne Links,Bühne Hinten,Bühne Innen,Bühne Links Innen,Bühne Links Hinten---Bühne Rechts Innen Hinten;13;1;Bühne,Rechts,Bühne Rechts,Bühne Hinten,Bühne Innen,Bühne Rechts Innen,Bühne Rechts Hinten---Bühne Rechts Außen Hinten;19;1;Bühne,Rechts,Bühne Rechts,Bühne Hinten,Bühne Außen,Bühne Rechts Außen,Bühne Rechts Hinten---Bühne Links Außen Vorne;25;1;Bühne,Links,Bühne Links,Bühne Vorne,Bühne Außen,Bühne Links Außen,Bühne Links Vorne---Bühne Links Innen Vorne;31;1;Bühne,Links,Bühne Links,Bühne Vorne,Bühne Innen,Bühne Links Innen,Bühne Links Vorne---Bühne Rechts Innen Vorne;37;1;Bühne,Rechts,Bühne Rechts,Bühne Vorne,Bühne Innen,Bühne Rechts Innen,Bühne Rechts Vorne---Bühne Rechts Außen Vorne;43;1;Bühne,Rechts,Bühne Rechts,Bühne Vorne,Bühne Außen,Bühne Rechts Außen,Bühne Rechts Vorne---Spot Links Oben;49;6;Spots,Spots Links,Spots Oben,Links---Spot Links Unten;55;6;Spots,Spots Links,Spots Unten,Links---Spot Rechts Oben;61;6;Spots,Spots Rechts,Spots Oben,Rechts---Spot Rechts Unten;67;6;Spots,Spots Rechts,Spots Unten,Rechts";console.debug("Loaded config",lights);const channels=[["Red","r","#ff0000",0],["Green","g","#00ff00",0],["Blue","b","#0000ff",0],["White","w","#ffffff",255],["Amber","a","#ffbf00",0],["UV","u","#5f4b8b",0]],rangeInputMin=0,rangeInputMax=255,rangeInputDefault=0,fadeRangeMin=0,fadeRangeMax=30,fadeRangeDefault=0,fadeDefaultTime=1,fadeLiveDefaultTime=0,channelsPerRGBLight=6;let groups={},liveUpdate=!1,groupToggle=!0,fullOn=0,fullOff=0,quickStates={fullOn:{_all:0},fullOff:{_all:0}};lights.split("---").forEach((e=>{let t=e.split(";")[3];0!==t.length&&t.split(",").forEach((t=>{groups[encodeURI(t)]||(groups[encodeURI(t)]=[]),groups[encodeURI(t)].push(e)}))})),console.debug("Groups",groups);const ws=new WebSocket("ws://127.0.0.1:81");try{ws.onopen=()=>{console.log("WS Opened")},ws.onmessage=e=>{console.log("WS Message",e)},ws.onerror=e=>{console.error("WS Error",e)}}catch(e){console.error(e)}class functions{static request=(e,t)=>new Promise(((n,o)=>{/^http(s)*:\/{2}/i.test(e)||(e=url.origin+e),t=t??{},fetch(e,t).then((e=>{n(e.body)})).catch(o)}));static submitConfig=e=>{this.request("/config",{headers:{plain:"string"!=typeof e?JSON.stringify(e):e},method:"POST"}).then((()=>{console.debug("POST Config Success")})).catch((e=>{console.error("POST Config error",e)}))};static getWhite=e=>"ffffff"===e.replace(/^#/,"").toLowerCase()?255:0;static hexToRGBParsed=e=>functions.hexToRGB(e);static hexToRGB=e=>{let t={};return e.replace(/^#/,"").match(/\w{2}/g).forEach(((e,n)=>t[["r","g","b"][n]]=parseInt(e,16))),t};static RGBToHex=(e,t,n,o)=>{let l="#";return l+=functions.pad2(Math.abs(e).toString(16)),l+=functions.pad2(Math.abs(t).toString(16)),l+=functions.pad2(Math.abs(n).toString(16)),l};static pad2=e=>/^\d$/.test(e)?`${parseInt(e)<10?"0":""}${e}`:`${e.length<2?"0":""}${e}`;static getValuesFromChannels=e=>{let t={};return channels.forEach((n=>{t[n[1]]=document.getElementById(`${e}-channels-${n[1]}`).value})),t};static appendValuesFromChannels=e=>{let t=functions.getValuesFromChannels(e),[n,o,l]=[t.r,t.g,t.b],s=functions.RGBToHex(n,o,l);return document.getElementById(`${e}-color`).value=s,s};static appendHexToChannels=(e,t)=>{let n=t??document.getElementById(`${e}-color`).value,o=functions.hexToRGBParsed(n),l={};return Object.keys(o).forEach((t=>{document.getElementById(`${e}-channels-${t}`).value=o[t],l[t]=o[t]})),l};static appendToChannels=(e,t)=>{Object.keys(t).forEach((n=>{document.getElementById(`${e}-channels-${n}`).value=t[n]}))};static updateLight=(e,t,n,o,l,s,c,a,i)=>{let r=[e,...[e,n,o,l,s,c,a,1e3*(i??0)].slice(1,7).map((e=>Math.floor(parseInt(e)*(1-(t??0)/100)))),1e3*i],d=[].concat(r,Array(8).slice(0,8-r.length));console.debug("WS Update RGB",d.join(";")),ws?.send(d.join(";"))};static updateLightnoRGB=(e,t,n)=>{console.debug("WS Update Non-RGB",[e,Math.floor(255*(1-t/100)),...[...Array(5)].map((e=>0)),1e3*n].join(";")),ws?.send([e,Math.floor(255*(1-t/100)),...[...Array(5)].map((e=>0)),1e3*n].join(";"))};static updateLightVal=(e,t,n)=>{let o=t;Array.isArray(o)||(o=[...Array(6)].map((e=>t))),console.debug("WS Update Val",[e,...o,1e3*n].join(";")),ws?.send([e,...o,1e3*n].join(";"))};static quickButtonActive=e=>{e.classList.add("quickActionButton-active")};static quickButtonInactive=e=>{e.classList.remove("quickActionButton-active")};static getQuickState=(e,t)=>quickStates[e]?.[t]??0}class scripts{static loadLights=()=>{lights.split("---").forEach(((e,t)=>{let[n,o,l,s]=e.split(";"),c=parseInt(l)>1,a=document.createElement("div");a.id=`controls${o}`,a.classList.add("controlsContainer");let i=document.createElement("div");i.classList.add("controlsContainerTop");let r=document.createElement("div");r.classList.add("controlsContainerBottom");let d=document.createElement("h");d.classList.add("controlsTitle"),d.innerText=n;let u=document.createElement("h");u.classList.add("controlsGroupTitle"),u.innerText=s.split(",").join(", ");let p=elements.controlsColorInput(a.id),h=elements.controlsChannelInputs(a.id),m=elements.controlsDimmerInput(a.id),f=elements.controlsFadeInput(a.id);p.onchange=()=>{B(),functions.appendHexToChannels(a.id)},h.onchange=()=>{B(),functions.appendValuesFromChannels(a.id)},m.onchange=()=>{B()},f.onchange=()=>{B()};let g=document.createElement("button");function B(e){let t=m.querySelector(".controlsDimmerInput").value,n=f.querySelector(".controlsFadeInput").value,l=1===functions.getQuickState("_all","fullOn")||1===functions.getQuickState("_all","fullOff");if(!c)return void(!e&&!liveUpdate||l||functions.updateLightnoRGB(o,t,n));let s=p.querySelector(".controlsColorInput").value,i=(functions.hexToRGBParsed(s),functions.getValuesFromChannels(a.id));!e&&!liveUpdate||l||functions.updateLight(o,t,...Object.values(i),n)}g.innerText="Update",g.classList.add("controlsSubmit"),g.onclick=()=>{B(!0)},[d,u].map((e=>i.appendChild(e))),[...c?[p,h]:[],m,f,g].forEach((e=>r.appendChild(e))),[i,r].map((e=>a.appendChild(e))),document.querySelector("#lightcontrols").appendChild(a)}))};static loadLightGroups=()=>{let e=document.createElement("div");e.classList.add("groupControlsContainer"),e.id="controlsGroup";let t=document.createElement("h");t.innerText="Group Controls",t.classList.add("controlsTitle");let n=document.createElement("select");n.classList.add("controlsSelector"),Object.keys(groups).forEach((e=>{let t=document.createElement("option");t.innerText=decodeURI(e),t.value=e,n.appendChild(t)}));let o=elements.controlsColorInput(e.id),l=elements.controlsChannelInputs(e.id),s=()=>`_group_${n.value}`,c=elements.controlsQuickActions(e.id,s,d),a=elements.controlsDimmerInput(e.id),i=elements.controlsFadeInput(e.id),r=document.createElement("button");function d(t,l,c,r){let d=o.querySelector(".controlsColorInput").value,u=a.querySelector(".controlsDimmerInput").value,p=i.querySelector(".controlsFadeInput").value,h=n.value;l&&functions.appendHexToChannels(e.id,d),c&&(d=functions.appendValuesFromChannels(e.id));let m=functions.getValuesFromChannels(e.id),f=1===functions.getQuickState(s(),"fullOn")||1===functions.getQuickState(s(),"fullOff");if(r)functions.updateLightVal(groups[h].map((e=>e.split(";")[1])).join(","),r,0);else if((t||liveUpdate)&&!f){let e=groups[h].filter((e=>parseInt(e.split(";")[2])>1)).map((e=>e.split(";")[1]));e.length>0&&functions.updateLight(e.join(","),u,...Object.values(m),p);let t=groups[h].filter((e=>1===parseInt(e.split(";")[2]))).map((e=>e.split(";")[1]));t.length>0&&functions.updateLightnoRGB(t.join(","),u,p)}groups[h].map((e=>e.split(";")[1])).forEach((e=>{let t=lights.split("---").filter((t=>t.split(";")[1]===e))[0]?.split(";"),n=t?.[1];if(void 0===n)return;if(!document.getElementById(`controls${n}`))return;let o=parseInt(t[2])>1;document.getElementById(`controls${n}-dimm`).value=u,document.getElementById(`controls${n}-fade`).value=p,o&&(document.getElementById(`controls${n}-color`).value=d,functions.appendToChannels(`controls${n}`,m))}))}r.innerText="Update",r.classList.add("controlsSubmit"),r.onclick=()=>{d(!0)},o.onchange=()=>{d(!1,!0,!1)},l.onchange=()=>{d(!1,!1,!0)},a.onchange=()=>{d()},i.onchange=()=>{d()},[t,n,o,l,c,a,i,r].forEach((t=>e.appendChild(t))),document.querySelector("#lightcontrolsgroup").appendChild(e)};static loadLightAll=()=>{let e=document.createElement("div");e.classList.add("groupControlsContainer"),e.id="controlsGroupAll";let t=document.createElement("h");t.innerText="Master Controls",t.classList.add("controlsTitle");let n=elements.controlsColorInput(e.id),o=elements.controlsChannelInputs(e.id),l=()=>"_all",s=elements.controlsQuickActions(e.id,l,r),c=elements.controlsDimmerInput(e.id),a=elements.controlsFadeInput(e.id),i=document.createElement("button");function r(t,o,l,s){let i=n.querySelector(".controlsColorInput").value,r=c.querySelector(".controlsDimmerInput").value,d=a.querySelector(".controlsFadeInput").value;o&&functions.appendHexToChannels(e.id,i),l&&(i=functions.appendValuesFromChannels(e.id));let u=functions.getValuesFromChannels(e.id),p=1===functions.getQuickState("_all","fullOn")||1===functions.getQuickState("_all","fullOff");if(s)functions.updateLightVal(lights.split("---").map((e=>e.split(";")[1])).join(","),s,0);else if((t||liveUpdate)&&!p){let e=lights.split("---").filter((e=>parseInt(e.split(";")[2])>1)).map((e=>e.split(";")[1]));e.length>0&&functions.updateLight(e.join(","),r,...Object.values(u),d);let t=lights.split("---").filter((e=>1===parseInt(e.split(";")[2]))).map((e=>e.split(";")[1]));t.length>0&&functions.updateLightnoRGB(t.join(","),r,d)}lights.split("---").map((e=>e.split(";"))).map((e=>{let t=e[1];if(!document.getElementById(`controls${t}`))return;let n=parseInt(e[2])>1;document.getElementById(`controls${t}-dimm`).value=r,document.getElementById(`controls${t}-fade`).value=d,n&&(document.getElementById(`controls${t}-color`).value=i,functions.appendToChannels(`controls${t}`,u))})),document.getElementById("controlsGroup")&&(document.getElementById("controlsGroup-color").value=i,document.getElementById("controlsGroup-dimm").value=r,document.getElementById("controlsGroup-fade").value=d,functions.appendToChannels("controlsGroup",u))}i.innerText="Update",i.classList.add("controlsSubmit"),i.onclick=()=>{r(!0)},n.onchange=()=>{r(!1,!0,!1)},o.onchange=()=>{r(!1,!1,!0)},c.onchange=()=>{r()},a.onchange=()=>{r()},[t,n,o,s,c,a,i].forEach((t=>e.appendChild(t))),document.querySelector("#lightcontrolsgroup").appendChild(e)};static loadLiveUpdateToggle=()=>{let e=document.createElement("div");e.id="liveUpdateContainer";let t=document.createElement("h");t.id="liveUpdateTitle",t.innerText="Live Update";let n=document.createElement("input");n.type="checkbox",n.onchange=()=>{liveUpdate=n.checked,scripts.appendLiveUpdate()},[t,n].forEach((t=>e.appendChild(t))),document.querySelector("body").appendChild(e)};static loadGroupToggle=()=>{let e=document.createElement("div");e.id="groupToggleContainer";let t=document.createElement("h");t.id="groupToggleTitle",t.innerText="Show groups";let n=document.createElement("input");n.type="checkbox",n.defaultChecked=!0,n.onchange=()=>{groupToggle=n.checked,scripts.appendGroupToggleUpdate()},[t,n].forEach((t=>e.appendChild(t))),document.querySelector("body").appendChild(e)};static appendLiveUpdate=()=>{document.querySelectorAll(".controlsSubmit").forEach((e=>{liveUpdate?e.classList.add("hidden"):e.classList.remove("hidden")})),document.querySelectorAll(".controlsFade").forEach((e=>{e.value=liveUpdate?0:1}))};static appendGroupToggleUpdate=()=>{document.querySelectorAll(".controlsGroupTitle").forEach((e=>{groupToggle?e.classList.remove("hidden"):e.classList.add("hidden")}))}}class elements{static br=()=>document.createElement("br");static spacer=()=>document.createElement("spacer");static controlsColorInput=e=>{let t=document.createElement("div");t.classList.add("controlsColorPickerContainer");let n=document.createElement("h");n.innerText="Color Picker";let o=document.createElement("input");return e&&(o.id=`${e}-color`),o.classList.add("controlsColorInput"),o.type="color",o.defaultValue="#000000",[n,o].forEach((e=>t.appendChild(e))),t};static controlsChannelInputs=e=>{let t=document.createElement("div");t.classList.add("controlsChannelsContainer");let n=document.createElement("div"),o=document.createElement("h");o.innerText="Channels";let l=document.createElement("div");e&&(l.id=`${e}-channels`),l.classList.add("controlsChannelsInputContainer");let s=document.createElement("div");return e&&(s.id=`${e}-channel-titles`),s.classList.add("controlsChannelTitlesContainer"),channels.forEach((t=>{let n=document.createElement("input");e&&(n.id=`${l.id}-${t[1]}`),n.classList.add("controlsChannelInput",`controlsChannel-${t[1]}`,"vertical"),n.type="range",n.style.backgroundColor=t[2],n.min=0,n.max=255,n.defaultValue=t[3];let o=document.createElement("h");o.classList.add("controlsChannelTitle"),o.title=t[0],o.innerText=t[1],l.appendChild(n),s.appendChild(o)})),[o,l,s].forEach((e=>n.appendChild(e))),t.appendChild(n),t};static controlsDimmerInput=e=>{let t=document.createElement("div");t.classList.add("controlsDimmerContainer");let n=document.createElement("div"),o=document.createElement("h");o.innerText="Dimmer";let l=document.createElement("input");return e&&(l.id=`${e}-dimm`),l.classList.add("dimmer"),l.classList.add("controlsDimmerInput","horizontal"),l.type="range",l.min=0,l.max=100,l.defaultValue=0,[o,l].forEach((e=>n.appendChild(e))),t.appendChild(n),t};static controlsFadeInput=e=>{let t=document.createElement("div");t.classList.add("controlsFadeContainer");let n=document.createElement("div"),o=document.createElement("h");o.innerText="Fade";let l=document.createElement("input");return l.id=`${e}-fade`,l.classList.add("controlsFadeInput","horizontal"),l.type="range",l.min=0,l.max=30,l.defaultValue=0,[o,l].forEach((e=>n.appendChild(e))),t.appendChild(n),t};static controlsQuickActions=(e,t,n)=>{let o=()=>t?.()??"_all",l=document.createElement("div");l.classList.add("controlsQuickActionsContainer");let s=document.createElement("button"),c=document.createElement("button");function a(e,t){switch(e){case"fullOn":quickStates[o()].fullOn=t,quickStates[o()].fullOff=2;break;case"fullOff":quickStates[o()].fullOff=t,quickStates[o()].fullOn=2}}function i(e){quickStates[o()]||(quickStates[o()]={fullOn:0,fullOff:0});let t=[s,c],l=t.indexOf(e.target),i=[...t].reverse().indexOf(e.target),r=t[l],d=t[i],u=["fullOn","fullOff"][l];switch(functions.getQuickState(o(),u)){case 0:case 2:functions.quickButtonActive(r),a(u,1),n(!1,!1,!1,[0,0,0,[255,0][l],0,0]);break;case 1:functions.quickButtonInactive(r),a(u,0)}functions.quickButtonInactive(d)}return s.innerText="Full On",c.innerText="Full Off",[s,c].map((e=>{e.classList.add("quickActionButton"),l.appendChild(e),e.onclick=i})),l}}window.onload=()=>{scripts.loadLights(),scripts.loadLightGroups(),scripts.loadLightAll(),scripts.loadLiveUpdateToggle(),scripts.loadGroupToggle()}</script><style>*{scrollbar-width:thin;font-family:"Trebuchet MS","Lucida Sans Unicode","Lucida Grande","Lucida Sans",Arial,sans-serif;border-radius:10px;text-align:center;user-select:none;padding:3px}.hidden{display:none}@media screen and (-webkit-min-device-pixel-ratio:0){.controlsChannelInput{overflow:hidden;appearance:none;-webkit-appearance:none;background-color:#fff;border:1px solid}.controlsChannelInput::-webkit-slider-runnable-track{height:10px;appearance:none;-webkit-appearance:none;color:#fff;background-color:transparent;margin-top:-1px}.controlsChannelInput::-webkit-slider-thumb{width:10px;-webkit-appearance:none;height:10px;border:1px solid #fff;border-radius:100%;background:0 0;box-shadow:396px 0 2px 400px #000}}.horizontal{cursor:w-resize}.vertical{cursor:n-resize}.controlsChannelInput{border:1px solid #fff;background-color:#000}.controlsChannelInput::-moz-range-progress{background-color:#fcca46}.controlsChannelInput::-moz-range-track{background-color:#000}body{background-color:#233d4d;transition:ease-in 2s;color:#f1faee;padding:3px}#lightcontrols,#lightcontrolsgroup{display:flex;place-items:center;flex-wrap:wrap;justify-content:center;align-items:stretch}.controlsContainer{display:flex;flex:1 0 24%}.controlsContainer,.groupControlsContainer{max-width:23%;padding:6px;margin:2px;width:25%;gap:3px;border:1px solid;background-color:#1d2d44;display:flex;flex-direction:column;align-items:center;justify-content:space-evenly}.groupControlsContainer{max-width:none;width:40%}spacer{display:flex;height:10px}.controlsTitle{font-size:large;height:50%}.controlsDimmerInput,.controlsFadeInput{width:80%}.controlsColorInput,.controlsSubmit{border:none;outline:0}.controlsSelector{border:1px solid transparent}.controlsColorInput{background-color:transparent;box-sizing:content-box;padding:0;height:30px}.controlsSubmit{padding:4px}.controlsGroupTitle{font-size:small;overflow-y:auto;height:50%}.controlsChannelsContainer,.controlsColorPickerContainer,.controlsDimmerContainer,.controlsFadeContainer,.controlsQuickActionsContainer{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;border:1px solid;flex-direction:column;width:100%}.controlsDimmerContainer>div,.controlsFadeContainer>div{display:flex;flex-direction:column;justify-content:center;align-items:center;width:90%}.controlsQuickActionsContainer{flex-direction:row}@media screen and (max-width:700px){.controlsChannelsContainer{display:none}}.controlsChannelsInputContainer{display:flex;flex-wrap:wrap;justify-content:center;flex-direction:column;transform:rotate(-90deg);row-gap:1px;justify-content:center;aspect-ratio:1/1.2}.controlsChannelTitle{cursor:help}.controlsChannelTitlesContainer{display:flex;justify-content:space-evenly}.controlsColorPickerContainer{flex-direction:column;justify-content:center}#liveUpdateContainer{background-color:#38a3a5;z-index:10;position:absolute;right:10px;top:10px}#groupToggleContainer{background-color:#38a3a5;z-index:10;position:absolute;left:10px;top:10px}.quickActionButton{display:flex;border-radius:6px;border:1px solid #f1faee;margin:2px;background-color:#220901;color:#f1faee}@keyframes blink{0%,49%{background-color:red;color:#000}50%,99%{background-color:#220901;color:#f1faee}}.quickActionButton-active{background-color:#a1c181;animation:blink 1s infinite}.controlsContainerBottom,.controlsContainerTop{display:flex;flex-direction:column;align-items:center;margin:0;padding:0;width:100%;gap:2px}.controlsContainerTop{height:45%}.controlsContainerTop{height:55%}</style>